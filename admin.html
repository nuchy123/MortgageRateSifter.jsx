<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rate Sheet Admin Portal</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState } = React;

    const AdminPortal = () => {
      const [file, setFile] = useState(null);
      const [rates, setRates] = useState([]);
      const [status, setStatus] = useState('');
      const [generatedCode, setGeneratedCode] = useState('');
      const [effectiveDate, setEffectiveDate] = useState('');

      const handleFileUpload = async (e) => {
        const uploadedFile = e.target.files[0];
        if (!uploadedFile) return;
        
        setFile(uploadedFile);
        setStatus('Processing file...');
        
        try {
          const data = await uploadedFile.arrayBuffer();
          const workbook = XLSX.read(data, { type: 'array' });
          
          // Get the first sheet
          const sheetName = workbook.SheetNames[0];
          const sheet = workbook.Sheets[sheetName];
          const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
          
          // Extract rates from the sheet
          const extractedRates = extractRatesFromSheet(jsonData);
          setRates(extractedRates);
          
          // Try to find effective date
          const dateMatch = uploadedFile.name.match(/(\d{1,2}[-_]\d{1,2}[-_]\d{2,4})/);
          if (dateMatch) {
            setEffectiveDate(dateMatch[1].replace(/_/g, '/').replace(/-/g, '/'));
          } else {
            setEffectiveDate(new Date().toLocaleDateString());
          }
          
          // Generate the JavaScript code
          generateRateCode(extractedRates);
          
          setStatus(`‚úÖ Found ${extractedRates.length} rates!`);
        } catch (error) {
          setStatus('‚ùå Error processing file: ' + error.message);
          console.error(error);
        }
      };

      const extractRatesFromSheet = (data) => {
        const rates = [];
        let currentProduct = '';
        let currentTerm = '';
        
        // Column mapping based on TPO Go format
        // Looking for rows with rate data
        
        for (let i = 0; i < data.length; i++) {
          const row = data[i];
          if (!row || row.length === 0) continue;
          
          const firstCell = String(row[0] || '').trim();
          
          // Detect product headers
          if (firstCell.includes('FHA') && firstCell.includes('30')) {
            currentProduct = 'FHA'; currentTerm = '30 Year Fixed';
          } else if (firstCell.includes('FHA') && firstCell.includes('15')) {
            currentProduct = 'FHA'; currentTerm = '15 Year Fixed';
          } else if (firstCell.includes('VA') && firstCell.includes('30')) {
            currentProduct = 'VA'; currentTerm = '30 Year Fixed';
          } else if (firstCell.includes('VA') && firstCell.includes('15')) {
            currentProduct = 'VA'; currentTerm = '15 Year Fixed';
          } else if (firstCell.includes('USDA')) {
            currentProduct = 'USDA'; currentTerm = '30 Year Fixed';
          } else if (firstCell.includes('Conventional') && firstCell.includes('30')) {
            currentProduct = 'Conventional'; currentTerm = '30 Year Fixed';
          } else if (firstCell.includes('Conventional') && firstCell.includes('15')) {
            currentProduct = 'Conventional'; currentTerm = '15 Year Fixed';
          } else if (firstCell.includes('Conv') && firstCell.includes('30')) {
            currentProduct = 'Conventional'; currentTerm = '30 Year Fixed';
          } else if (firstCell.includes('Conv') && firstCell.includes('15')) {
            currentProduct = 'Conventional'; currentTerm = '15 Year Fixed';
          }
          
          // Check if this row has rate data (first cell is a number like 4.5, 5.0, etc.)
          const rateValue = parseFloat(row[0]);
          if (!isNaN(rateValue) && rateValue >= 3 && rateValue <= 12 && currentProduct) {
            // Look for price columns (values around 95-105)
            const prices = [];
            for (let j = 1; j < row.length && prices.length < 4; j++) {
              const price = parseFloat(row[j]);
              if (!isNaN(price) && price >= 90 && price <= 110) {
                prices.push(price);
              }
            }
            
            if (prices.length >= 4) {
              rates.push({
                product: currentProduct,
                term: currentTerm,
                rate: rateValue,
                lock15: prices[0],
                lock30: prices[1],
                lock45: prices[2],
                lock60: prices[3]
              });
            }
          }
        }
        
        return rates;
      };

      const generateRateCode = (rateData) => {
        const rateArrayStr = rateData.map(r => 
          `{product:'${r.product}',term:'${r.term}',rate:${r.rate},lock15:${r.lock15},lock30:${r.lock30},lock45:${r.lock45},lock60:${r.lock60}}`
        ).join(',\n        ');
        
        setGeneratedCode(`const rateData = [
        ${rateArrayStr}
      ];`);
      };

      const copyToClipboard = () => {
        navigator.clipboard.writeText(generatedCode);
        setStatus('‚úÖ Code copied to clipboard!');
      };

      const downloadFullHTML = () => {
        // Generate complete index.html with new rates
        const fullHTML = generateFullHTML(rates, effectiveDate);
        const blob = new Blob([fullHTML], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'index.html';
        a.click();
        URL.revokeObjectURL(url);
        setStatus('‚úÖ index.html downloaded! Upload it to GitHub.');
      };

      const generateFullHTML = (rateData, date) => {
        const rateArrayStr = rateData.map(r => 
          `{product:'${r.product}',term:'${r.term}',rate:${r.rate},lock15:${r.lock15},lock30:${r.lock30},lock45:${r.lock45},lock60:${r.lock60}}`
        ).join(',\n        ');

        return `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TPO Go Rate Sheet Sifter</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"><\/script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"><\/script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"><\/script>
  <script src="https://cdn.tailwindcss.com"><\/script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useMemo } = React;

    const MortgageRateSifter = () => {
      const [filters, setFilters] = useState({
        productType: 'all', loanType: 'all', lockPeriod: '30', fico: '', ltv: '',
        loanAmount: '', purchasePrice: '', occupancy: 'all', propertyType: 'singlefamily',
        loanPurpose: 'all', escrowWaiver: false, zipCode: '', state: '', city: ''
      });
      const [brokerComp, setBrokerComp] = useState(2.5);
      const [expandedRows, setExpandedRows] = useState({});

      const nyPrimaryPayups = {
        5.0: 0, 5.125: 0, 5.25: 0.096, 5.375: 0.096, 5.5: 0.095, 5.625: 0.095,
        5.75: 0.534, 5.875: 0.595, 6.0: 0.696, 6.125: 0.715, 6.25: 1.243,
        6.375: 1.257, 6.5: 1.416, 6.625: 1.527, 6.75: 2.356, 6.875: 2.396,
        7.0: 2.311, 7.125: 2.311, 7.25: 1.926, 7.375: 1.927, 7.49: 1.927
      };

      const getPayup = (rate, state, occupancy, product, term) => {
        if (product !== 'Conventional' || !term.includes('30')) return 0;
        if (state !== 'NY') return 0;
        const rates = Object.keys(nyPrimaryPayups).map(Number).sort((a,b) => a-b);
        let closest = rates[0];
        for (const r of rates) { if (Math.abs(r - rate) < Math.abs(closest - rate)) closest = r; }
        return nyPrimaryPayups[closest] || 0;
      };

      const zipDatabase = {
        '10952': {state:'NY',city:'Monsey'}, '10977': {state:'NY',city:'Spring Valley'},
        '10901': {state:'NY',city:'Suffern'}, '11201': {state:'NY',city:'Brooklyn'},
        '90001': {state:'CA',city:'Los Angeles'}, '60601': {state:'IL',city:'Chicago'},
        '75201': {state:'TX',city:'Dallas'}, '33101': {state:'FL',city:'Miami'},
        '07601': {state:'NJ',city:'Hackensack'}, '08701': {state:'NJ',city:'Lakewood'}
      };

      const rateData = [
        ${rateArrayStr}
      ];

      const states = [
        {code:'AL',name:'Alabama'},{code:'AZ',name:'Arizona'},{code:'CA',name:'California'},
        {code:'CO',name:'Colorado'},{code:'CT',name:'Connecticut'},{code:'DC',name:'DC'},
        {code:'DE',name:'Delaware'},{code:'FL',name:'Florida'},{code:'GA',name:'Georgia'},
        {code:'IL',name:'Illinois'},{code:'IN',name:'Indiana'},{code:'IA',name:'Iowa'},
        {code:'KY',name:'Kentucky'},{code:'LA',name:'Louisiana'},{code:'MA',name:'Massachusetts'},
        {code:'MD',name:'Maryland'},{code:'ME',name:'Maine'},{code:'MI',name:'Michigan'},
        {code:'MS',name:'Mississippi'},{code:'NC',name:'North Carolina'},{code:'NH',name:'New Hampshire'},
        {code:'NJ',name:'New Jersey'},{code:'NY',name:'New York'},{code:'OH',name:'Ohio'},
        {code:'OK',name:'Oklahoma'},{code:'OR',name:'Oregon'},{code:'PA',name:'Pennsylvania'},
        {code:'PR',name:'Puerto Rico'},{code:'RI',name:'Rhode Island'},{code:'SC',name:'South Carolina'},
        {code:'TN',name:'Tennessee'},{code:'TX',name:'Texas'},{code:'VA',name:'Virginia'},
        {code:'VT',name:'Vermont'},{code:'WA',name:'Washington'},{code:'WI',name:'Wisconsin'},
        {code:'WV',name:'West Virginia'}
      ];

      const handleFilterChange = (key, value) => {
        setFilters(prev => {
          const updated = {...prev, [key]: value};
          if (key === 'zipCode' && value.length === 5 && zipDatabase[value]) {
            updated.state = zipDatabase[value].state;
            updated.city = zipDatabase[value].city;
          }
          if (key === 'purchasePrice' && value && updated.ltv) {
            updated.loanAmount = Math.round(parseFloat(value) * parseFloat(updated.ltv) / 100);
          } else if (key === 'loanAmount' && value && updated.purchasePrice) {
            updated.ltv = ((parseFloat(value) / parseFloat(updated.purchasePrice)) * 100).toFixed(2);
          } else if (key === 'ltv' && value && updated.purchasePrice) {
            updated.loanAmount = Math.round(parseFloat(updated.purchasePrice) * parseFloat(value) / 100);
          }
          return updated;
        });
      };

      const calculatePriceAdjustments = (basePrice, product, rate, term) => {
        let adjustment = 0;
        const breakdown = [];
        const fico = parseInt(filters.fico);
        const ltv = parseFloat(filters.ltv);
        const state = filters.state;

        if (state && product === 'Conventional') {
          let stateAdj = 0;
          if (['AL','CO','DC','DE','GA','IA','IN','LA','MD','ME','MI','MS','NH','NY','OK','TN','VT','WI','WV'].includes(state)) stateAdj = 0;
          else if (['AZ','CA','KY','NC','OH','OR','PA','RI','SC','VA','WA'].includes(state)) stateAdj = 0.1;
          else if (state === 'TX') stateAdj = 0.15;
          else if (['CT','FL','MA','IL'].includes(state)) stateAdj = 0.2;
          else if (state === 'NJ') stateAdj = 0.325;
          else if (state === 'PR') stateAdj = -0.15;
          if (stateAdj !== 0) { adjustment += stateAdj; breakdown.push({label:'State: '+state, value:stateAdj}); }
        }

        if (product === 'Conventional' && filters.loanPurpose === 'purchase' && fico && ltv) {
          let ficoLtvAdj = 0;
          if (ltv > 75 && ltv <= 80) {
            if (fico >= 780) ficoLtvAdj = -0.375;
            else if (fico >= 760) ficoLtvAdj = -0.625;
            else if (fico >= 740) ficoLtvAdj = -0.875;
            else if (fico >= 720) ficoLtvAdj = -1.25;
            else if (fico >= 700) ficoLtvAdj = -1.375;
            else if (fico >= 680) ficoLtvAdj = -1.75;
            else if (fico >= 660) ficoLtvAdj = -1.875;
            else ficoLtvAdj = -2.25;
          } else if (ltv > 70 && ltv <= 75) {
            if (fico >= 780) ficoLtvAdj = 0;
            else if (fico >= 760) ficoLtvAdj = -0.25;
            else if (fico >= 740) ficoLtvAdj = -0.375;
            else if (fico >= 720) ficoLtvAdj = -0.75;
            else ficoLtvAdj = -0.875;
          }
          if (ficoLtvAdj !== 0) { adjustment += ficoLtvAdj; breakdown.push({label:'FICO x LTV', value:ficoLtvAdj}); }
        }

        if (filters.propertyType === 'condo' && product === 'Conventional') {
          adjustment += -0.75; breakdown.push({label:'Condo LLPA', value:-0.75});
        }

        if (product === 'Conventional') {
          adjustment += 0.125; breakdown.push({label:'Fixed Amortization', value:0.125});
        }

        const payup = getPayup(rate, state, filters.occupancy, product, term);
        if (payup !== 0) { adjustment += payup; breakdown.push({label:'Pay-Up Incentive', value:payup}); }

        return {adjustment, adjustedPrice: basePrice + adjustment, breakdown};
      };

      const filteredData = useMemo(() => {
        const filtered = rateData.filter(item => {
          const matchesProduct = filters.productType === 'all' || item.product === filters.productType;
          const matchesTerm = filters.loanType === 'all' || item.term === filters.loanType;
          return matchesProduct && matchesTerm;
        });

        const withCosts = filtered.map(item => {
          const basePrice = item['lock' + filters.lockPeriod] || item.lock30;
          const calcResult = calculatePriceAdjustments(basePrice, item.product, item.rate, item.term);
          const priceAfterBrokerComp = calcResult.adjustedPrice - brokerComp;
          let discountRebate = 0;
          if (filters.loanAmount) {
            discountRebate = (100 - priceAfterBrokerComp) * parseFloat(filters.loanAmount) / 100;
          }
          const monthlyRate = item.rate / 100 / 12;
          const numPayments = 360;
          const principal = parseFloat(filters.loanAmount) || 0;
          const monthlyPayment = principal > 0 ? principal * (monthlyRate * Math.pow(1+monthlyRate,numPayments)) / (Math.pow(1+monthlyRate,numPayments)-1) : 0;
          const totalCost = discountRebate + (monthlyPayment * 360 - principal);
          return {...item, basePrice, calcResult, priceAfterBrokerComp, discountRebate, monthlyPayment, totalCost};
        });

        let bestIdx = -1, lowestCost = Infinity;
        if (filters.loanAmount) {
          withCosts.forEach((item, i) => { if (item.totalCost < lowestCost) { lowestCost = item.totalCost; bestIdx = i; }});
        }
        return withCosts.map((item, i) => ({...item, isBestOption: i === bestIdx && filters.loanAmount}));
      }, [filters, brokerComp]);

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
          <div className="max-w-7xl mx-auto">
            <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
              <h1 className="text-2xl font-bold text-gray-800">TPO Go Rate Sheet Sifter</h1>
              <p className="text-gray-600">Effective Date: ${date}</p>
            </div>

            <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
              <h2 className="text-lg font-semibold mb-4">Filters</h2>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div>
                  <label className="block text-sm font-medium mb-1">Product</label>
                  <select value={filters.productType} onChange={e => handleFilterChange('productType', e.target.value)} className="w-full p-2 border rounded">
                    <option value="all">All</option>
                    <option value="FHA">FHA</option>
                    <option value="VA">VA</option>
                    <option value="USDA">USDA</option>
                    <option value="Conventional">Conventional</option>
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-medium mb-1">Term</label>
                  <select value={filters.loanType} onChange={e => handleFilterChange('loanType', e.target.value)} className="w-full p-2 border rounded">
                    <option value="all">All</option>
                    <option value="30 Year Fixed">30 Year</option>
                    <option value="15 Year Fixed">15 Year</option>
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-medium mb-1">Lock Period</label>
                  <select value={filters.lockPeriod} onChange={e => handleFilterChange('lockPeriod', e.target.value)} className="w-full p-2 border rounded">
                    <option value="15">15-Day</option>
                    <option value="30">30-Day</option>
                    <option value="45">45-Day</option>
                    <option value="60">60-Day</option>
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-medium mb-1">ZIP Code</label>
                  <input type="text" value={filters.zipCode} onChange={e => handleFilterChange('zipCode', e.target.value)} placeholder="10952" maxLength="5" className="w-full p-2 border rounded" />
                </div>
                <div>
                  <label className="block text-sm font-medium mb-1">State</label>
                  <select value={filters.state} onChange={e => handleFilterChange('state', e.target.value)} className="w-full p-2 border rounded">
                    <option value="">Select</option>
                    {states.map(s => <option key={s.code} value={s.code}>{s.name}</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-medium mb-1">FICO</label>
                  <input type="number" value={filters.fico} onChange={e => handleFilterChange('fico', e.target.value)} placeholder="750" className="w-full p-2 border rounded" />
                </div>
                <div>
                  <label className="block text-sm font-medium mb-1">Purchase Price</label>
                  <input type="number" value={filters.purchasePrice} onChange={e => handleFilterChange('purchasePrice', e.target.value)} placeholder="800000" className="w-full p-2 border rounded" />
                </div>
                <div>
                  <label className="block text-sm font-medium mb-1">LTV %</label>
                  <input type="number" value={filters.ltv} onChange={e => handleFilterChange('ltv', e.target.value)} placeholder="80" className="w-full p-2 border rounded" />
                </div>
                <div>
                  <label className="block text-sm font-medium mb-1">Loan Amount</label>
                  <input type="number" value={filters.loanAmount} onChange={e => handleFilterChange('loanAmount', e.target.value)} placeholder="640000" className="w-full p-2 border rounded" />
                </div>
                <div>
                  <label className="block text-sm font-medium mb-1">Broker Comp %</label>
                  <input type="number" step="0.125" value={brokerComp} onChange={e => setBrokerComp(parseFloat(e.target.value) || 0)} className="w-full p-2 border rounded" />
                </div>
                <div>
                  <label className="block text-sm font-medium mb-1">Loan Purpose</label>
                  <select value={filters.loanPurpose} onChange={e => handleFilterChange('loanPurpose', e.target.value)} className="w-full p-2 border rounded">
                    <option value="all">All</option>
                    <option value="purchase">Purchase</option>
                    <option value="rateterm">Rate/Term Refi</option>
                    <option value="cashout">Cash-Out Refi</option>
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-medium mb-1">Property Type</label>
                  <select value={filters.propertyType} onChange={e => handleFilterChange('propertyType', e.target.value)} className="w-full p-2 border rounded">
                    <option value="singlefamily">Single Family</option>
                    <option value="condo">Condo</option>
                    <option value="2-4unit">2-4 Units</option>
                  </select>
                </div>
              </div>
            </div>

            <div className="bg-white rounded-lg shadow-lg p-6">
              <h2 className="text-lg font-semibold mb-4">Results ({filteredData.length})</h2>
              <div className="overflow-x-auto">
                <table className="w-full text-sm">
                  <thead className="bg-indigo-50">
                    <tr>
                      <th className="p-3 text-left">Product</th>
                      <th className="p-3 text-left">Term</th>
                      <th className="p-3 text-center">Rate</th>
                      <th className="p-3 text-center">Price</th>
                      <th className="p-3 text-center">Adjustments</th>
                      {filters.loanAmount && <th className="p-3 text-center">Disc/Rebate</th>}
                      {filters.loanAmount && <th className="p-3 text-center">Monthly P&I</th>}
                      {filters.loanAmount && <th className="p-3 text-center">Total Cost</th>}
                    </tr>
                  </thead>
                  <tbody>
                    {filteredData.map((item, i) => (
                      <React.Fragment key={i}>
                        <tr className={item.isBestOption ? 'bg-yellow-50 border-2 border-yellow-400' : 'border-b hover:bg-gray-50'}>
                          <td className="p-3">
                            <span className={\`px-2 py-1 rounded text-xs font-semibold \${
                              item.product === 'FHA' ? 'bg-blue-100 text-blue-800' :
                              item.product === 'VA' ? 'bg-green-100 text-green-800' :
                              item.product === 'USDA' ? 'bg-yellow-100 text-yellow-800' :
                              'bg-purple-100 text-purple-800'
                            }\`}>{item.product}</span>
                            {item.isBestOption && <span className="ml-2 px-2 py-1 rounded text-xs font-bold bg-yellow-400">BEST</span>}
                          </td>
                          <td className="p-3">{item.term}</td>
                          <td className="p-3 text-center font-semibold">{item.rate.toFixed(3)}%</td>
                          <td className="p-3 text-center">
                            <span className={\`font-bold \${item.priceAfterBrokerComp >= 100 ? 'text-green-600' : 'text-red-600'}\`}>
                              {item.priceAfterBrokerComp.toFixed(3)}
                            </span>
                          </td>
                          <td className="p-3 text-center">
                            <span className={item.calcResult.adjustment >= 0 ? 'text-green-600' : 'text-red-600'}>
                              {item.calcResult.adjustment >= 0 ? '+' : ''}{item.calcResult.adjustment.toFixed(3)}
                            </span>
                            {item.calcResult.breakdown.length > 0 && (
                              <button onClick={() => setExpandedRows(prev => ({...prev, [i]: !prev[i]}))} className="ml-2 text-xs text-indigo-600 underline">
                                {expandedRows[i] ? 'hide' : 'details'}
                              </button>
                            )}
                          </td>
                          {filters.loanAmount && (
                            <td className="p-3 text-center">
                              <span className={item.discountRebate < 0 ? 'text-green-600' : 'text-red-600'}>
                                \${Math.abs(item.discountRebate).toLocaleString('en-US', {maximumFractionDigits: 0})}
                              </span>
                              <div className="text-xs text-gray-500">{item.discountRebate < 0 ? 'Credit' : 'Cost'}</div>
                            </td>
                          )}
                          {filters.loanAmount && <td className="p-3 text-center">\${item.monthlyPayment.toLocaleString('en-US', {maximumFractionDigits: 0})}</td>}
                          {filters.loanAmount && <td className="p-3 text-center font-bold">\${item.totalCost.toLocaleString('en-US', {maximumFractionDigits: 0})}</td>}
                        </tr>
                        {expandedRows[i] && (
                          <tr><td colSpan="8" className="p-3 bg-gray-50">
                            <div className="text-sm max-w-md">
                              <div className="font-semibold mb-2">Breakdown:</div>
                              {item.calcResult.breakdown.map((b, j) => (
                                <div key={j} className="flex justify-between">
                                  <span>{b.label}:</span>
                                  <span className={b.value >= 0 ? 'text-green-600' : 'text-red-600'}>{b.value >= 0 ? '+' : ''}{b.value.toFixed(3)}</span>
                                </div>
                              ))}
                              <div className="border-t mt-2 pt-2">
                                <div className="flex justify-between"><span>Base:</span><span>{item.basePrice.toFixed(3)}</span></div>
                                <div className="flex justify-between"><span>Adjusted:</span><span>{item.calcResult.adjustedPrice.toFixed(3)}</span></div>
                                <div className="flex justify-between text-red-600"><span>Broker:</span><span>-{brokerComp.toFixed(3)}</span></div>
                                <div className="flex justify-between font-bold"><span>Net:</span><span>{item.priceAfterBrokerComp.toFixed(3)}</span></div>
                              </div>
                            </div>
                          </td></tr>
                        )}
                      </React.Fragment>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>

            <div className="mt-6 bg-indigo-600 text-white rounded-lg p-4 text-center">
              <p>TPO Go Wholesale | Lock Desk: (860) 676-8003 | tpogo.com</p>
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<MortgageRateSifter />);
  <\/script>
</body>
</html>`;
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-gray-900 to-indigo-900 p-6">
          <div className="max-w-4xl mx-auto">
            <div className="bg-white rounded-xl shadow-2xl p-8 mb-6">
              <div className="flex items-center gap-3 mb-6">
                <div className="w-12 h-12 bg-indigo-600 rounded-lg flex items-center justify-center">
                  <svg className="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                  </svg>
                </div>
                <div>
                  <h1 className="text-2xl font-bold text-gray-800">Rate Sheet Admin Portal</h1>
                  <p className="text-gray-500">Upload XLS ‚Üí Download Updated Calculator</p>
                </div>
              </div>

              <div className="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-indigo-500 transition-colors">
                <input
                  type="file"
                  accept=".xls,.xlsx"
                  onChange={handleFileUpload}
                  className="hidden"
                  id="fileUpload"
                />
                <label htmlFor="fileUpload" className="cursor-pointer">
                  <div className="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg className="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                    </svg>
                  </div>
                  <p className="text-lg font-medium text-gray-700">Click to upload rate sheet</p>
                  <p className="text-sm text-gray-500 mt-1">XLS or XLSX files</p>
                </label>
              </div>

              {status && (
                <div className={`mt-4 p-4 rounded-lg ${status.includes('‚úÖ') ? 'bg-green-100 text-green-800' : status.includes('‚ùå') ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800'}`}>
                  {status}
                </div>
              )}

              {file && (
                <div className="mt-4 p-4 bg-gray-100 rounded-lg">
                  <p className="font-medium">üìÑ {file.name}</p>
                  {effectiveDate && <p className="text-sm text-gray-600">Effective Date: {effectiveDate}</p>}
                </div>
              )}
            </div>

            {rates.length > 0 && (
              <>
                <div className="bg-white rounded-xl shadow-2xl p-8 mb-6">
                  <h2 className="text-xl font-bold mb-4">üìä Extracted Rates ({rates.length})</h2>
                  <div className="overflow-x-auto max-h-64 overflow-y-auto">
                    <table className="w-full text-sm">
                      <thead className="bg-gray-100 sticky top-0">
                        <tr>
                          <th className="p-2 text-left">Product</th>
                          <th className="p-2 text-left">Term</th>
                          <th className="p-2 text-center">Rate</th>
                          <th className="p-2 text-center">15-Day</th>
                          <th className="p-2 text-center">30-Day</th>
                          <th className="p-2 text-center">45-Day</th>
                          <th className="p-2 text-center">60-Day</th>
                        </tr>
                      </thead>
                      <tbody>
                        {rates.map((r, i) => (
                          <tr key={i} className="border-b">
                            <td className="p-2">{r.product}</td>
                            <td className="p-2">{r.term}</td>
                            <td className="p-2 text-center">{r.rate}%</td>
                            <td className="p-2 text-center">{r.lock15}</td>
                            <td className="p-2 text-center">{r.lock30}</td>
                            <td className="p-2 text-center">{r.lock45}</td>
                            <td className="p-2 text-center">{r.lock60}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </div>

                <div className="bg-white rounded-xl shadow-2xl p-8">
                  <h2 className="text-xl font-bold mb-4">üöÄ Update Your Calculator</h2>
                  <div className="flex gap-4">
                    <button
                      onClick={downloadFullHTML}
                      className="flex-1 bg-indigo-600 text-white py-4 px-6 rounded-lg font-semibold hover:bg-indigo-700 transition-colors"
                    >
                      ‚¨áÔ∏è Download Updated index.html
                    </button>
                    <button
                      onClick={copyToClipboard}
                      className="flex-1 bg-gray-600 text-white py-4 px-6 rounded-lg font-semibold hover:bg-gray-700 transition-colors"
                    >
                      üìã Copy Rate Code Only
                    </button>
                  </div>
                  <p className="text-sm text-gray-500 mt-4 text-center">
                    After downloading, upload the index.html to your GitHub repo to update your live calculator.
                  </p>
                </div>
              </>
            )}
          </div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<AdminPortal />);
  </script>
</body>
</html>
